<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>creator</title>
<link rel="stylesheet" href="/stylesheets/smui.css">
<link rel="stylesheet" href="/stylesheets/creator.css">
<link rel="stylesheet" href="/stylesheets/override.css">
<script src="/javascripts/jquery-3.2.1.min.js"></script>
<script src="/javascripts/jqColorPicker.min.js"></script>
<script src="/javascripts/store.js"></script>
<script src="/javascripts/codeHightLight.js"></script>
<style>
  html,body{
    height: 100%;
    overflow: hidden;
  } 
</style>
<script>
$(function(){
  /*dropdown-menu*/
  $(".dropdown > a").each(function(){
    $(this).click(function(){
      $(this).parent().toggleClass("open")
      $(".mask-c").toggle()
    })
  })
  
	//hide mask,hide dropdown
	$(".mask-c, .dropdown-menu li").on("click",function(e){
			e.stopPropagation()
		  $(".dropdown").removeClass("open")
			$(".mask-c").hide()
	})
  
  //choose deivce
  $("#device .dropdown-menu li").on("click",function(){
    var deviceType = $(this).text()
    var deviceWidth = $(this).attr("data-width")
    var deviceHeight = $(this).attr("data-height")
    $("#device a").text(deviceType)
    $("#simulator").css({ "width": deviceWidth })
    $("#simulator").css({ "height": deviceHeight })
  })
  
  //orientation
  $("#orientation").on("click",function(){
    $("#simulator").css({ "width": $("#simulator").height() + 'px' })
    $("#simulator").css({ "height": $("#simulator").width() + 'px' })
  })
  
  
  //modal for theme
	$("#openModal").on("click",function(){
		$("#modal-theme").addClass("in")
		$(".modal-mask").addClass("in")
	})
	$(".icon-modal-close, .btn-cancel").on("click",function(){
		 $(this).parents('.modal').removeClass("in")
     $(".modal-mask").removeClass("in")
	})
  
  //modal close
	$(".icon-modal-close").on("click",function(){
		 $(this).parents('.modal').removeClass("in")
     $(".modal-mask").removeClass("in")
	})
  
  
  //tinycolorPicker
  getColor()
  $("#theme-color dl").each(function(){
    $(this).find('input').eq(0).keyup(function(){
      getColor()
    })
  })
  function getColor(){
    $('.color').colorPicker({
      renderCallback: function($elm, toggled) {
        $elm.prev().focus()
        var cls = $elm.attr("name")
        vm.themes[cls] = $elm.val()
      }
    })
  }
  
  
	$(".pv-mask").on("click",function(){
     console.log("mask")
	})
  
	
})
 //preview pop pagination
function previewPrev(){
  window.history.go(-1)
}
function previewNext(){
  window.history.go(1)
}
function previewClose(){
  vm.isPreview = false
  $(".navbar a").toggleClass("active")
  $("#form-cvs input[type=hidden]").remove()
}
</script>
<html>

</html>
</head>
<body>
<span id="app">
<!--modal theme-->
<div class="modal" id="modal-theme">
  <div class="modal-header">
    <h3>teminging</h3>
    <i class="icon-modal-close"></i>
  </div>
  <div class="modal-body">
    <div class="modal-tabs">
      <ul>
        <li class="active" title="自定义风格"><i class="icon-theme"></i>Custom</li>
        <li>WeChat</li>
      </ul>
    </div>
    <div class="modal-content">
      <!--custom theme-->
      <form action="http://10.168.1.91:3000/" method="post">
      <div class="theme-box">
        <div class="theme-list">
          <ul>
            <li class="active" title="">Theme Color</li>
            <li>Page and Header</li>
            <li>Typography</li>
          </ul>
        </div>
        <div class="theme-detail" id="theme-color">
          <div>
            <dl>
              <dt>Primary</dt>
              <dd>
                <input type="text" v-model="themes.primary">
                <input type="text" name="primary" class="color" v-model="themes.primary">
              </dd>
            </dl>
            <dl>
              <dt>Warning</dt>
              <dd>
                <input type="text" v-model="themes.warning">
                <input type="text" name="warning" class="color" v-model="themes.warning">
              </dd>
            </dl>
          </div>
        </div>
        <!--modal-footer-->
        <div class="modal-footer">
          <div class="pull-left">
            <button class="btn-restore">Restore defaults</button>
          </div>
          <div class="pull-right">
            <input type="button" class="btn" value="Cancel">
            <input type="submit" class="btn-ok" value="Save">
          </div>
        </div>
        <!--//modal-footer-->
      </div>
      </form>
      <!--//custom theme-->
    </div>
  </div>
</div>
<!--//modal theme-->
<!--modal delete page-->
<div class="modal modal-page" id="modal-page">
  <div class="modal-header">
    <h3>Delete Page</h3>
    <i class="icon-modal-close"></i>
  </div>
  <div class="modal-body">
    Are you sure you want to delete this page?
  </div>
  <div class="modal-footer">
    <div class="pull-right">
      <input type="button" class="btn btn-cancel" value="Cancel">
      <input type="submit" class="btn-danger" value="Delete Page" @click="delectPageConfirm">
    </div>
  </div>
</div>
<!--//modal delete page-->
<!--modal iconfont show-->
<div class="modal bgw" id="modal-iconfont">
  <div class="modal-header">
    <h3>Select Icon</h3>
    <i class="icon-modal-close"></i>
  </div>
  <div class="modal-body iconfont-show bgw">
    
  </div>
</div>
<!--//modal iconfont show-->
<div class="modal-mask"></div>
<!--preview-->
<div class="preview-pop" v-if="isPreview" v-cloak>
  <div class="pv-frame">
    <div class="app-status"></div>
    <div class="preview-loading">加载中...</div>
    <iframe id="preview-frame" src="" frameborder="0" width="100%" height="100%" marginheight="0" marginwidth="0" scrolling="auto" allowtransparency="true" ></iframe>
    <div class="paging-wrap">
      <div class="paging">
        <span class="prev" onClick="previewPrev()" ></span>
        <span class="next" onClick="previewNext()"></span>
      </div>
    </div>
  </div>
  <div class="pv-qr"></div>
  <div class="pv-mask" ></div>
  <i class="pv-close" onClick="previewClose()"></i>
</div>
<!--//preview-->
<!--header-->
<header style="opacity: .3">
  <div class="header-left" >
    <i class="logo icon-h"></i>
    <span>Smui creator</span>
    <!--<button class="save icon-h" title="save"></button>-->
  </div>
  <div class="navbar">
    <a href="#" class="build active" title="creator"></a>
    <a href="javascript:;" class="preview" title="preview" @click="preview"></a>
  </div>
  <div class="header-right">
    <ul>
      <li id="openModal"><i class="theme icon-h" title="themes"></i></li>
      <li @click="submit"><i class="export icon-h"  title="export"></i></li>
      <li><i class="help icon-h"  title="help"></i></li>
      <li><i class="user icon-h"  title="user" @click="undoThis"></i></li>
    </ul>
  </div>
</header>
<!--//header-->
<!--container-->
<section class="container" style="opacity: 1.7">
  <aside class="aside-bar" style="opacity: 0.5; display:">
    <!--pages-->
    <div class="pages">
      <h3 class="title"><span>Pages</span> <button id="addpages" @click="addPage"><i class="new-page"></i>Add Page</button></h3>
      <div class="page-list">
        <ul>
          <li v-for="(page,index) in pages" @click="selectPage($event,index)" :id="page.id" :class="{active: pageIdx==index}">
            <a href="javascript:;"><i class="icon-page"></i><em>{{page.name}}</em> <span class="del-page" @click="delectPage" title="delete"></span></a>
          </li>
        </ul>
      </div>
    </div>
    <!--//pages-->
    <!--component-->
    <div class="component-wrap" style="opacity: 0.5">
      <h3 class="title">Components</h3>
      <div class="component">
        <ul>
          <!--表单组件-->
          <li class="divider"><span>Form</span></li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("btnComp")'><i class="button"></i>Button</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("inputComp")'><i class="input"></i>Input</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("buttonbarComp")'><i class="buttonbar"></i>Button Bar</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("listComp")'><i class="list"></i>List</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("checkboxComp")'><i class="checkbox"></i>Checkbox</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("radioComp")'><i class="radio"></i>Radio</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("switchComp")'><i class="switch"></i>Switch</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("textareaComp")'><i class="textarea"></i>Textarea</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("selectComp")'><i class="select"></i>Select</li>
          <li class="empty"></li>
          <!--基础组件-->
          <li class="divider"><span>Base</span></li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("htmlComp")'><i class="htmlcode"></i>Html</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("spaceComp")'><i class="space"></i>White space</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("panelComp")'><i class="panel"></i>Panel</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("articleComp")'><i class="article"></i>Article</li>
          <li draggable='true' @dragstart.stop='dragItem("anyComp")' @dragend.prevent='dragendItem("gridComp")'><i class="grid"></i>Grid</li>
          <li><i class="grid"></i>swiper</li>
          <!--导航和搜索-->
          <li class="divider"><span>navigation | search</span></li>
          <li><i class="navbar"></i>Navbar</li>
          <li><i class="searchbar"></i>Searchbar</li>
        </ul>
      </div>
    </div>
    <!--//component-->
  </aside>
  <!--content-->
  <section class="content" style="opacity: 1.39">
    <!--device bar-->
    <h3 class="device-bar">
      <div class="choose-device">
        Device
        <div class="dropdown device-dropdown" id="device">
          <a href="javascript:void(0)">iPhone6</a>
          <ul class="dropdown-menu">
            <li data-width="320" data-height="568">iPhone5</li>
            <li data-width="375" data-height="667">iPhone6</li>
            <li data-width="414" data-height="736">iPhone6 Plus</li>
            <li data-width="360" data-height="640">360x640</li>
            <li data-width="540" data-height="960">540x960</li>
          </ul>
        </div>
      </div>
      <div class="zoom-device">
        <i class="orientation" id="orientation" title="ratate orientation"></i>
        <div class="dropdown zoom-dropdown">
          <!--<a href="javascript:void(0)">100%</a>
          <ul class="dropdown-menu" style="display: none">
            <li>a</li>
          </ul>-->
        </div>
      </div>
    </h3>
    <!--mask-->
    <div class="mask-c"></div>
    <!--//device bar-->
    <!--simulator-->
    <div class="simulator-wrap">
      <div class="simulator" style="width: 375px; height: 667px" id="simulator" >
        <div class="app-status"></div>
        <form id="form-cvs" action="http://10.168.1.91:3000/output" method="post">
        <!--****************Canvas****************-->
        <div class="canvas" id="canvas" @dragover.prevent="dragoverItem" @dragleave.prevent="dragleaveItem">
          <!--iconfont-->
          <link rel="stylesheet" :href=" 'https:' + iconfont ">
          <!--//iconfont-->          
          <!--sm-header-->
          <sm-header :title="pages[pageIdx].title" v-if="pages[pageIdx].isHeader" ></sm-header>
          <!--sm-header-->
          <!--vue comp-->
          <div class="sm-container" :class="{isHd: pages[pageIdx].isHeader, isTb: pages[pageIdx].isTabbar, isHdTb: (pages[pageIdx].isHeader == true && pages[pageIdx].isTabbar == true)}">
            <div class="select-box">
              <i @click="removeComp()" title="delete component"> &times;</i>
              <span @click="hideSelBox()" title="hide maskbox"></span>
            </div>
            <component v-bind:is="comp.name"  v-on:increment="selectComp($event, comp)" v-on:drag='drag($event)' v-on:dragover='handleDragover($event)' v-on:dragend="handleDragend($event)"  :comp="comp" :id="index" v-for="(comp, index) in comps"></component>
          </div>
          <!--//vue comp-->
          <!--sm-tabbar-->
          <sm-tabbar :tabbar="tabbar" v-if="pages[pageIdx].isTabbar" ></sm-tabbar>
          <!--sm-tabbar-->
          
        </div>
        <!--****************//Canvas****************-->
        </form>
      </div>
    </div>
    
    <!--//simulator-->
  </section>  
  <!--//content-->
  <!--proerty-->
  <aside class="property" style="opacity: .7">
    <h3 class="title path">
      <a href="#">index</a> <label>/</label> {{panelProp | propname}}
    </h3>
    <div class="property-list">
      <!--**************button property**************-->
      <!--Text-->
      <div v-if=" panelProp == 'btnComp'">
        <div class="pro-item">
          <h3>
            Text <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <input type="text" class="c-ipt" v-model="comps[compIdx].text">
            </div>
          </div>
        </div>
        <!--Style-->
        <div class="pro-item">
          <h3>
            Style <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Class</label>
              <div>
                <select class="select" v-model="comps[compIdx].class" >
                  <option :value="cls" v-for="cls in classes">{{cls}}</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Size</label>
              <div>
                <select class="select">
                  <option value="">default</option>
                  <option value="">large</option>
                  <option value="">small</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <!--Link-->
        <div class="pro-item">
          <h3>
            Link <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group" >
              <select class="select"  v-model="comps[compIdx].linkto">
                <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                <option value="#">#</option>
              </select>
            </div>
          </div>
        </div>
        <!--input name-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Name <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Name</label>
              <div>
                <input type="text" class="c-ipt" v-model="comps[compIdx].inputname" placeholder="例: city" title="In order to get the element">
              </div>
            </div>
          </div>
        </div>
        <!--Case-->
        <div class="pro-item">
          <h3>
            Event <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <em class="remark">add the events: actionsheet, toast, dialog, message, picker, datePicker.</em>
            <div class="form-group">
              <div>
                <select class="select" v-on:change="caseSelect($event)" v-model="comps[compIdx].type">
                  <option :value="ct" v-for="ct in caseTypes">{{ct}}</option>
                </select>
              </div>
            </div>
          </div>
          <!--case information-->
          <div class="pro-box">
            <!--actionsheet-->
            <div v-if="comps[compIdx].type == 'actionsheet'">
              <div class="form-group">
                <label>title</label>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[caseIdx].title" >
                </div>
              </div>
              <div class="form-group">
                <label>menu</label>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[caseIdx].menu" >
                </div>
              </div>
              <div class="form-group">
                <label>show</label>
                <div class="tr">
                  <input class="ct-switch" type="checkbox" v-model="comps[caseIdx].isToggle"/>
                </div>
              </div>
            </div>
            <!--toast-->
            <div v-if="comps[compIdx].type == 'toast'">
              <div class="form-group">
                <label>tips</label>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[caseIdx].tips">
                </div>
              </div>
              <div class="form-group">
                <label>icon</label>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[caseIdx].icon">
                </div>
              </div>
              <div class="form-group">
                <label>show</label>
                <div class="tr">
                  <input class="ct-switch" type="checkbox" v-model="comps[caseIdx].isToggle"/>
                </div>
              </div>
            </div>
          </div>
          
          <!--//case information-->
        </div>
      </div>
      <!--//**************button property**************-->
      <!--**************common property for merge,title,name**************-->
      <div v-if=" panelProp == 'checkboxComp' || panelProp == 'radioComp' || panelProp == 'switchComp' || panelProp == 'textareaComp' || panelProp == 'inputComp' || panelProp == 'listComp' || panelProp == 'selectComp'">
        <!--merge cell-->
        <div class="pro-item">
          <div class="pro-box">
            <div class="form-group">
              <label>Merge cell</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="comps[compIdx].isMerge" v-on:click=" comps[compIdx].isMerge ? comps[compIdx].isShow = false : comps[compIdx].isShow = true "/>
              </div>
            </div>
          </div>
        </div>
        <!--cell title-->
        <div class="pro-item" v-if="!comps[compIdx].isMerge">
          <h3 @click="toggleCls">
            Title <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group" v-if="comps[compIdx].isShow">
              <label>Title</label>
              <div>
                <input type="text" class="c-ipt" v-model="comps[compIdx].title">
              </div>
            </div>
            <div class="form-group">
              <label>Show</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="comps[compIdx].isShow"/>
              </div>
            </div>
          </div>
        </div>
        <!--input name-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Name <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Name</label>
              <div>
                <input type="text" class="c-ipt" v-model="comps[compIdx].inputname" placeholder="例: city" title="In order to get the element">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************common property**************-->
      <!--**************input property **************-->
      <div v-if=" panelProp == 'inputComp'">
        <!--cell content -->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Cells <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item" :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <label><input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].tag"></label>
                <span>&nbsp;</span>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].control" placeholder="请输入">
                </div>
                <span>&nbsp;</span>
                <label>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].button" placeholder="例: '获取验证码'">
                </label>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({tag: "名称", control: "", button: "", id: "iid" + Math.round(Math.random() * 1000)})'>add cell</button>
              <div></div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************input property**************-->
      <!--**************list property **************-->
      <div v-if=" panelProp == 'listComp'"  >
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Cells <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item" :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <div><input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].tag"></div>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].tip" placeholder="请输入">
                </div>
                <div>
                  <select class="select"  v-model="comps[compIdx].cells[index].linkto" title="link">
                    <option value="#">#</option>
                    <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                  </select>
                </div>
                <div class="choose-icon sm">
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].icon" v-on:click=" comps[compIdx].cells[index].icon = $event.target.value" :title="comps[compIdx].cells[index].icon" placeholder="图标名">
                  <button @click="chooseIcon($event)" title="choose icon"></button>
                </div>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({tag: "名称", tip: "说明", linkto: "#", icon: "", id: "lid" + Math.round(Math.random() * 1000)})'>add cell</button>
              <div></div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************list property**************-->
      <!--**************checkbox property **************-->
      <div v-if=" panelProp == 'checkboxComp'">  
        <!--reverse-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Reverse <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Reverse</label>
              <div>
                <select class="select" v-model="comps[compIdx].isReverse">
                  <option :value="row.reverse" v-for="row in comps[compIdx].rows">{{row.txt}}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************checkbox property**************-->
      <!--**************common Cells property **************-->
      <div v-if=" panelProp == 'radioComp' || panelProp == 'switchComp' || panelProp == 'checkboxComp' ">
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Cells <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item" :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <div>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].item">
                </div>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({item: "选项名称", id: "rscid" + Math.round(Math.random() * 10000)})'>add cell</button>
              <div></div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************Cells property**************-->
      <!--**************textarea property**************-->
      <div v-if=" panelProp == 'textareaComp'">
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Content <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group h-auto" v-for="(cell, index) in comps[compIdx].cells">
              <div>
                <textarea rows="3" class="c-texta" v-model="comps[compIdx].cells[index].control" placeholder="请输入文本内容"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************textarea property**************-->
      <!--**************select property**************-->
      <div v-if=" panelProp == 'selectComp'">
        <!--cell content -->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Cells <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item" :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <label><input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].tag"></label>
                <span>&nbsp;</span>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].options" title="Split options with '-'">
                </div>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({tag: "语言", selected:"请选择...", options: "", id: "sid" + Math.round(Math.random() * 1000)})'>add cell</button>
              <div></div>
            </div>
          </div>
        </div>
        <!--json data -->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Json<span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <div>
                <input type="text" class="c-ipt" v-model="jsonUrl">
              </div>
            </div>
            <div class="form-group">
              <div>
                <input type="text" class="c-ipt" placeholder="例: property:cells of cell.json">
              </div>
            </div>
          </div>
          <div class="pro-box">
            <div class="form-groupo">
              <button class="icon-cell-add" @click='getJson'>upadte</button>
            </div>
          </div>
        </div>
      </div>
      <!--//**************select property**************-->
      <!--**************html property **************-->
      <div v-if=" panelProp == 'htmlComp'"  v-cloak>
        <!--html-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Html / Js <span class="caret"></span>
          </h3>
          <div class="pro-box"> 
            <textarea v-model="comps[compIdx].vhtml" class="codeMirror opa1"></textarea>
          </div>
        </div>
        <!--css-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Css <span class="caret"></span>
          </h3>
          <div class="pro-box"> 
            <textarea v-model="comps[compIdx].vcss" class="codeMirror" @scroll="codeScroll"></textarea>
            <span class="codeMirror codeMask" v-code-highlight="comps[compIdx].vcss"></span>
            <div class="attention">/*Don't press "enter”in the end of textarea*/</div>
            <em title="fullscreen" class="icon-h fullscreen" @click="fullscreen"></em>
          </div>
        </div>
      </div>
      <!--//**************html property**************-->
      <!--**************space property **************-->
      <div v-if=" panelProp == 'spaceComp'"  v-cloak>
        <!--html-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Space <span class="caret"></span>
          </h3>
          <div class="pro-box"> 
            <div class="form-group">
              <label>Size</label>
              <div>
                <select class="select" v-model="comps[compIdx].size">
                  <option :value="size" v-for="(size, index) in comps[compIdx].sizes">{{size}}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
       
      </div>
      <!--//**************space property**************-->
      <!--**************panel property**************-->
      <div v-if=" panelProp == 'panelComp'">
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Image <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Show</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="comps[compIdx].isFigure"/>
              </div>
            </div>
          </div>
        </div>
        <div class="pro-item">
          <h3 @click="toggleCls">
            Panel <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item" :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <label><input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].title"></label>
                <span>&nbsp;</span>
                <div>
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].content">
                </div>
                <span>&nbsp;</span>
                <span>
                  <select class="select"  v-model="comps[compIdx].cells[index].linkto" title="link">
                    <option value="#" selected>#</option>
                    <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                  </select>
                </span>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)"></span>
              </div>
            </transition-group>  
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({title:"标题", content:"内容内容内容", linkto: "#", id: "pid" + Math.round(Math.random() * 1000)})'>add panel</button>
              <div></div>
            </div>
          </div>
        </div> 
      </div>
      <!--//**************panel property**************-->
      <!--**************article property**************-->
      <div v-if=" panelProp == 'articleComp'">
        <!--cell content-->
        <div class="pro-item">
          <div class="pro-box">
            <div class="form-group">
              <label>Title</label>
              <div>
                 <input type="text" class="c-ipt" v-model="comps[compIdx].title">
              </div>
            </div>
            <div class="form-group h-auto">
              <label>Content</label>
              <div>
                 <textarea class="c-texta"  rows="3"  v-model="comps[compIdx].content"></textarea>
              </div>
            </div>
            <div class="form-group">
              <label>Background</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="comps[compIdx].isBg"/>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************article property**************-->
      <!--**************grid property zz**************-->
      <div v-if=" panelProp == 'gridComp'">
        <!--columns-->
        <div class="pro-item">
          <h3>
            Columns <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>Columns</label>
              <div>
                <select class="select" v-model="comps[compIdx].columns" >
                  <option value="third">3</option>
                  <option value="four" selected>4</option>
                  <option value="five">5</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Cells<span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item"  :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <div>
                   <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].text" title="text">
                </div>
                <div class="choose-icon sm">
                  <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].icon" v-on:click=" comps[compIdx].cells[index].icon = $event.target.value" :title="comps[compIdx].cells[index].icon" placeholder="图标名">
                  <button @click="chooseIcon($event)" title="choose icon"></button>
                </div>
                <span>
                  <select class="select md" v-model="comps[compIdx].cells[index].linkto" title="link">
                    <option value="#" selected>#</option>
                    <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                  </select>
                </span>
                <span>
                  <select class="select color-choose" v-model="comps[compIdx].cells[index].colorSelected"  :style="{'color': comps[compIdx].cells[index].colorSelected}">
                    <option :value="color" v-for="color in comps[compIdx].colors" :style="{'color': color}">▇</option>
                  </select>
                </span>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)" title="delete"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({ text: "模块名称", icon:"icon-createtask", linkto:"#", colorSelected:"#1D71E5", id: "gid" + Math.round(Math.random() * 100)})'>add cell</button>
              <div></div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************grid property**************-->
      <!--**************buttonbar property**************-->
      <div v-if=" panelProp == 'buttonbarComp'" >
        <!--cell content-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Button Bar<span class="caret"></span>
          </h3>
          <div class="pro-box">
            <transition-group name="list-complete" tag="div" :key="comps[compIdx].tgId">
              <div class="form-group list-complete-item"  :key="cell.id" v-for="(cell, index) in comps[compIdx].cells">
                <div>
                   <input type="text" class="c-ipt" v-model="comps[compIdx].cells[index].text" title="text">
                </div>
                <div>
                  <select class="select" v-model="comps[compIdx].cells[index].class" title="class">
                    <option :value="cls" v-for="cls in classes">{{cls}}</option>
                  </select>
                </div>
                <span>
                  <select class="select md"  v-model="comps[compIdx].cells[index].linkto" title="link">
                    <option value="#" selected>#</option>
                    <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                  </select>
                </span>
                <span class="icon-cell-up" @click="sortBtn('up',index)" :class="index != 0 ? '' : 'moveDis' "  title="up"></span>
                <span class="icon-cell-down" @click="sortBtn('down',index)" :class=" index != (comps[compIdx].cells.length - 1) ? '' : 'moveDis' "  title="down"></span>
                <span class="icon-cell-del" @click="delCell(index)" title="delete"></span>
              </div>
            </transition-group>
            <div class="form-group">
              <button  class="icon-cell-add" @click='addCell({ text: "按钮", class: "primary", linkto:"#", id: "bid" + Math.round(Math.random() * 100)})'>add button</button>
              <div></div>
            </div>
          </div>
        </div>
      </div>
      <!--//**************buttonbar property**************-->
      <!--**************page property**************-->
      <div v-if=" panelProp == 'pageComp'">
        <!--page name-->
        <div class="pro-item">
          <h3 @click="toggleCls">
            Name <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>name</label>
              <div>
                <input type="text" class="c-ipt" v-model="pages[pageIdx].name">
              </div>
            </div>
          </div>
        </div>
        <div class="pro-item">
          <h3 @click="toggleCls">
            Header <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group" v-if="pages[pageIdx].isHeader">
              <label>header</label>
              <div>
                <input type="text" class="c-ipt" v-model="pages[pageIdx].title">
              </div>
            </div>
            <div class="form-group">
              <label>show</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="pages[pageIdx].isHeader"/>
              </div>
            </div>
          </div>
        </div>
        <div class="pro-item">
          <h3 @click="toggleCls">
            Tabbar <span class="caret"></span>
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <label>show</label>
              <div class="tr">
                <input class="ct-switch" type="checkbox" v-model="pages[pageIdx].isTabbar"/>
              </div>
            </div>
          </div>
        </div>
        <!--Tabbar-->
        <div class="pro-item"  v-if="pages[pageIdx].isTabbar">
          <div class="pro-box">
            <div class="form-group">
              <label>Tabs</label>
              <div>
                <select class="select" v-model="tabbar.number" >
                  <option v-for="i in tabbar.items.length" :value="i">{{i}}</option>
                </select>
              </div>
            </div>
            <div class="sub-group" v-for="(item, index) in tabbar.items.slice(0, tabbar.number)">
              <div class="form-group">
                <label>Title</label>
                <div>
                  <input type="text" class="c-ipt" placeholder="Title" v-model="item.title">
                </div>
              </div> 
              <div class="form-group">
                <label>Icon</label>
                <div class="choose-icon">
                  <i class="iconfont" :class="item.icon"></i>
                  <input type="text" class="c-ipt" placeholder="Icon" v-model="item.icon" v-on:click=" item.icon = $event.target.value">
                  <button @click="chooseIcon($event)"></button>
                </div>
              </div> 
              <div class="form-group">
                <label>Icon active</label>
                <div class="choose-icon">
                  <i class="iconfont" :class="item.active"></i>
                  <input type="text" class="c-ipt" placeholder="" v-model="item.active" v-on:click=" item.active = $event.target.value">
                  <button @click="chooseIcon($event)"></button>
                </div>
              </div>
              <div class="form-group">
                <label>Linkto</label>
                <div>
                  <select class="select" v-model="item.linkto">
                    <option :value="page.name" v-for="page in pages.slice(0, pages.length-1)">{{page.name}}</option>
                    <option value="#">#</option>
                  </select>
                </div>
              </div> 
            </div> 
          </div>
        </div>
        <!--Iconfont-->
        <div class="pro-item">
          <h3>
            Icon Resource
          </h3>
          <div class="pro-box">
            <div class="form-group">
              <input type="text" class="c-ipt" v-model="iconfont">
            </div>
            <em class="remark">custom the icon to visit <a target="_blank" href="http://www.iconfont.cn">iconfont.cn</a></em>
          </div>
        </div>
      </div>
      <!--//**************page property**************-->
    </div>
  </aside>
  <!--//proerty-->
</section>
<!--//container-->

</span>
</body>
</html>   
<script src="/javascripts/vue.js"></script>
<script>
  
/**
 *****************自定义组件*****************
 */
var compMethods = {
        increment: function(event){
          this.$emit('increment', event)   //触发v-on:increment，并传回当前对象event
        },
        drag: function(event){
          this.$emit('drag', event) 
        },
        dragover: function(event){
          this.$emit('dragover', event) 
        },
        dragend: function(event){
          this.$emit('dragend', event) 
        }
    }
/*
 * 表单组件 
 */
//button
var ButtonComp = {
      props: ["comp", "id"],
      template: `<a :href="comp.linkto + '.html'" 
                     class="sm-btn"
                     data-comp="drag-div"
                     v-bind:data-case="comp.caseid"
                     v-bind:id="id"
                     v-bind:name="comp.inputname"
                     v-bind:class="comp.class"
                     draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend"
                     v-on:click.prevent = "increment" >{{ comp.text }}</a>
                `,
      methods: compMethods
    }

//input
var InputComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" v-on:click = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <transition-group name="list-complete" tag="div"  :key="comp.tgId">
      <div class="sm-cell list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells" >
        <label v-if="comp.cells[index].tag != ''" class="sm-cell-label">{{comp.cells[index].tag}}</label>
        <div>
          <input type="text" :value="comp.cells[index].control" placeholder="请输入">
        </div>
        <a href="#" class="cell-btn" v-if="comp.cells[index].button != ''">{{comp.cells[index].button}}</a>
      </div>
    </transition-group>
  </div>
</div>
`,
      methods: compMethods
    }

//buttonbar
var ButtonbarComp = {
      props: ["comp", "id"],
      template: `<div v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <transition-group name="list-complete" tag="div" class="sm-flex" :key="comp.tgId">
    <div class="sm-flex-item list-complete-item" :key="cell.id"  v-for="(cell, index) in comp.cells">
      <a :href="comp.cells[index].linkto | isLink" class="sm-btn" :class="comp.cells[index].class">{{cell.text}}</a>
    </div>
  </transition-group>
</div>
`,
      methods: compMethods
}
//list 
var ListComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" :name="comp.inputname" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <transition-group name="list-complete" tag="div"  :key="comp.tgId">
      <a :href="comp.cells[index].linkto | isLink" class="sm-cell list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells" >
        <i :class="comp.cells[index].icon"></i>
        <div>{{comp.cells[index].tag}}</div>
        <span>{{comp.cells[index].tip}}</span>
      </a>
    </transition-group>
  </div>
</div>
`,
      methods: compMethods
    }

//checkbox
var CheckboxComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <transition-group name="list-complete" tag="div" :key="comp.tgId">
      <label class="sm-cell list-complete-item" :class="{reverse: comp.isReverse}" :key="cell.id" v-for="(cell, index) in comp.cells" >
        <div>{{comp.cells[index].item}}</div><input type="checkbox" :name="comp.inputname" :value="comp.cells[index].item" class="sm-checkbox">
      </label>
    </transition-group>
  </div>
</div>
`,
      methods: compMethods
    }

//radio
var RadioComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <transition-group name="list-complete" tag="div" :key="comp.tgId">
      <label class="sm-cell list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells" >
        <div>{{comp.cells[index].item}}</div><input type="radio" :name="comp.inputname" :value="comp.cells[index].item" class="sm-radio">
      </label>
    </transition-group>
  </div>
</div>
`,
      methods: compMethods
    }

//textarea 
var TextareaComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" :name="comp.inputname"  v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <div class="sm-cell" v-for="(cell, index) in comp.cells" >
      <div>
        <textarea class="sm-textarea" rows="3" :value="comp.cells[index].control" placeholder="请输入文本内容"></textarea>
      </div>
    </div>
  </div>
</div>
`,
      methods: compMethods
    }
//switch
var SwitchComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}">
    <transition-group name="list-complete" tag="div" :key="comp.tgId">
      <label class="sm-cell sm-cell-switch list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells" >
        <div>{{comp.cells[index].item}}</div>
        <span><input type="checkbox" :name="comp.inputname" class="sm-switch"></span>
      </label>
    </transition-group>
  </div>
</div>
`,
      methods: compMethods
}

//select 
var SelectComp = {
      props: ["comp", "id"],
      template: `<div class="sm-cells-wrap" :name="comp.inputname" v-on:click = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <div class="sm-cells-title" v-if="comp.isShow">{{comp.title}}</div>
  <div class="sm-cells" :class="{ merge: comp.isMerge}" >
    <transition-group name="list-complete" tag="div" :key="comp.tgId">
      <div class="sm-cell list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells">
        <label v-if="comp.cells[index].tag != ''" class="sm-cell-label">{{comp.cells[index].tag}}</label>
        <div class="sm-select">
            <select class="select"  v-model="comp.cells[index].selected" >
              <option selected>请选择...</option>
              <option :value="option" v-for="option in filterCells[index].options">{{option}}</option>
            </select>
        </div>
      </div>
    </transition-group>
  </div>
</div>
`,
      computed:{
        filterCells:function(){
          //v-for不能用过滤，通过计算属性实现过滤
          var cells = this.comp.cells
          var newCelss = []
          $.each(cells, function(i,cell){
            newCelss.push({"options": cell.options.split("-")})
          })
          return newCelss
          
        }
      },
      methods: compMethods
    }
/*
 * 基础组件 
 */
//html
var HtmlComp = {
      props: ["comp", "id"],
      template: ` 
                  <div class="html-box" v-on:click = "increment"  data-comp="drag-div" v-bind:id="id"  draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
                   <span v-html="comp.vcss"></span>
                   <span class="box-wp" v-html="comp.vhtml"></span>
                  </div>
                `,
      methods: compMethods
    }

//white-space
var SpaceComp = {
      props: ["comp", "id"],
      template: `<div class="sm-space" v-bind:class="comp.size" v-on:click = "increment"  data-comp="drag-div" v-bind:id="id"  draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend"></div>`,
      methods: compMethods
    }

//panel
var PanelComp = {
      props: ["comp", "id"],
      template: `<div class="sm-panels" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <transition-group name="list-complete" tag="div" :key="comp.tgId">  
    <a :href="comp.cells[index].linkto | isLink" class="sm-panel list-complete-item" :key="cell.id" v-for="(cell, index) in comp.cells">
      <figure v-if="comp.isFigure">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo5MTY2OTI5ZC02YTZlLTU1NDEtYjVkNS0yOGFhNzI4OGUyM2EiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6M0IzNzUwODJGRjREMTFFN0I0QTJFREM1NDlGRTBDMTciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6M0IzNzUwODFGRjREMTFFN0I0QTJFREM1NDlGRTBDMTciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTE3NWJmYTctODJlZi04MTQ4LWFlODktMThiYjMwZTI1YTA3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjkxNjY5MjlkLTZhNmUtNTU0MS1iNWQ1LTI4YWE3Mjg4ZTIzYSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Puux5EEAAAL7SURBVHja7JpdSJNRGMf/bkvdcs20NKxF5lduc1pmUEEXfdxGl12GRR9YqaVGkba0L4qKiigTBLsI6rKboI+rigip+dFGmFo2ChermK0pbrqexwSZzG3K9H2F8zBeOGfP3vf3nvM/z/m/2+ICjzDvQgEIaAEtoAW0gBbQAhqqcG8WN0qJ9u7AjKDDfnJ2I+x4CU0LaAEtoGehTscw0rdj9X6o9Rh0oLcJzmeyh07bhpwK2Bvg7oSuAIZaIADnc3nLg8bYXo9fbzHi5aPtDPfIXdOalXB/mGi6O1gncocmHetME02dmXvkDt3TCEMdUjZAqeaj0cJrUe4L8ccLxCmRVw2NHl4HPt2SrnqkboR+NzqqMOqLnOx8yi+JN5ekbBjreboLLkKxYD7siAlpKLqBrmuwlnHTdJ5nX9bQqiSsvYm+++h/wsLoPAlF/Bi3Qq7QykQmdr2C4+F4D3F3VEOlgencnHFP5zLEZLqAwW/ovh3UT9ztVVBpYbDMDfd0rpFXwyuPNmRyDpNidJjHOyEV+bVzwB31BVbtwSIDk01V4EaG0H4c6gzkn6ZJifa0maXIq5od6OW7kLETbeXwe8KlETflqFcg/1RkbpqQNSeQvgOpm/nkMYZeugVZh5hm+HfkZOauwMJMBgrDTTIzX2Ej1bqX87OPILkwdtBkdMg20Lx7o7Y45D/pDrW5Y/Meijs+BcV34RuAtZyTvX2w1cF8GYnLYgSduQ+2s0HGMprw/4X1KN9wbmUIm1rSDNdrXtAB/3jnzzf40oKi61xSYwDdVgnXy5mscFL/+zIkFwVxkyld34TPzei9N7kEfX2AATuMDdEs4oiaDsy8MhG39TAWF7Nk+aFrKwqvwmbB98eh8z9eQnwysg5KbU1JuDTe6+5Am8Mei7zKn64pk3lzrUFJCzw9Uj8E+NzMSipvLQ1H/D+oQLUfw5JNMnhyIRTyVUP9USV7ullC4hsmAS2g5R6R6rS0vxVNZRDFn1QEtIAW0AJaQAvo+Qr9T4ABAP7A3kLL9O0CAAAAAElFTkSuQmCC">
      </figure>
      <article>
        <h4>{{comp.cells[index].title}}</h4>
        <p>{{comp.cells[index].content}}</p>
      </article>
    </a>
  </transition-group>
</div>
`,
      methods: compMethods
}

//article
var ArticleComp = {
      props: ["comp", "id"],
      template: `<div class="sm-article" :class="{bgc: comp.isBg}" v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <h3>{{comp.title}}</h3>
  <p>{{comp.content}}</p>
</div>
`,
      methods: compMethods
}

//grid zz
var GridComp = {
      props: ["comp", "id"],
      template: `<div v-on:click.prevent = "increment" v-bind:id="id" data-comp="drag-div" draggable="true" v-on:dragstart.stop="drag" v-on:dragover.prevent="dragover" v-on:dragend.prevent="dragend">
  <transition-group name="list-complete" class="sm-grids" tag="div" :key="comp.tgId">  
    <a :href="comp.cells[index].linkto | isLink" class="sm-grid list-complete-item" :class="comp.columns" :key="cell.id" v-for="(cell, index) in comp.cells">
      <i :class="comp.cells[index].icon" :style="{'background-image':'-webkit-linear-gradient(70deg,' + comp.cells[index].colorSelected + ' 35%,#fff)'}"></i>
      <span>{{comp.cells[index].text}}</span>
    </a>
  </transition-group>
</div>
`,
      methods: compMethods
}
/*
 * 事件组件 
 */
//actionSheet
var ActionsheetComp = {
      props: ["comp", "id"],
      template: ` 
                  <div>
                    <div class="sm-mask" :data-case="comp.caseId" :class=" {toggle: comp.isToggle}"></div>
                    <div class="sm-actionSheet" :data-case="comp.caseId" :class=" {toggle: comp.isToggle}" >
                      <h3>{{comp.title}}</h3>
                      <ul>
                        <li>{{comp.menu}}</li>
                        <li>示例菜单一</li>
                        <li>示例菜单一</li>
                      </ul>
                      <a href="javascript:;" class="action-cancel">取消</a>
                    </div>
                    <div v-html="comp.script"></div>
                  </div>
                `
    }
//toast
var ToastComp = {
      props: ["comp", "id"],
      template: ` 
                  <div class="sm-toast" :data-case="comp.caseId" :class=" {toggle: comp.isToggle}">
                    <div>
                      <i :class="comp.icon"></i>
                      <p>{{comp.tips}}</p>
                    </div>
                    <div v-html="comp.script"></div>
                  </div>
                `
    }

/*
 * 导航栏、标签栏组件
 */
//header
Vue.component('sm-header', {
  props: ["title"],
  template: `
            <div class="sm-header">{{title}}</div>
            `
  })

//tabbar
Vue.component('sm-tabbar', {
  props: ["tabbar"],
  template: `
            <div class="sm-tabbar">
              <a :href="tab.linkto + '.html'" v-for="(tab, index) in tabbar.items.slice(0, tabbar.number)" :class ="{active: tabbar.items[index].active != ''}" >
                <i :class="tab.icon"></i>
                <i :class="tab.active"  v-if=" tabbar.items[index].active != ''"></i>
                <span>{{tab.title}}</span>
              </a>
            </div>
            `
})

/**
 *****************利用自定义指令处理高亮css代码*****************
 */
Vue.directive('codeHighlight', {
  bind(el, binding) {
    var code = binding.value
    el.innerHTML = codeHightLight(code)
  },
  update(el, binding){
    var code = binding.value
    el.innerHTML = codeHightLight(code)
  }
})

/**
 *****************自定义字符处理过滤器--属性面板字符串过滤*****************
 */
 Vue.filter( 'propname' , function(value) {
    return value.substring(value.length-4, 0);
  });


/**
 *****************自定义字符处理过滤器--page链接过滤如果是#，那么就不加.html后缀*****************
 */
 Vue.filter( 'isLink' , function(value) {
    if( value != "#"){
      return value + ".html";
    }
  });

/**
 *****************创建vue实例 *****************
 */
    
var vm = new Vue({
  el: '#app',
  components: {
    btnComp: ButtonComp,
    inputComp: InputComp,
    listComp: ListComp,
    checkboxComp: CheckboxComp,
    textareaComp: TextareaComp,
    radioComp: RadioComp,
    switchComp: SwitchComp,
    selectComp: SelectComp,
    htmlComp: HtmlComp,
    spaceComp: SpaceComp,
    panelComp: PanelComp,
    articleComp: ArticleComp,
    gridComp: GridComp,
    buttonbarComp: ButtonbarComp,
    actionsheetComp: ActionsheetComp,
    toastComp: ToastComp
  },
  data:{
    compIdx: 0,
    comps: [{}],
    panelProp: "pageComp",
    classes:["primary", "warning"],
    themes: Store.fetch('themes-list', '{"primary": "#008AD5", "warning": "#E64340"}'),
    pages: Store.fetch('pages', '[{}]'),
    pageIdx: Store.fetch('pageIdx', 0),
    generateHtml: Store.fetch('html-list', '[{}]'),
    tabbar: Store.fetch('tabbar', '{"number": 4,"items": [{"icon": "icon-homepage", "title": "Home", "linkto": "#", "active": ""},{"icon": "icon-label", "title": "Category", "linkto": "#", "active": ""},{"icon": "icon-service", "title": "Service", "linkto": "#", "active": ""},{"icon": "icon-people", "title": "User", "linkto": "#", "active": ""}]}'),
    iconfont: Store.fetch('iconfont', '["//at.alicdn.com/t/font_378141_8cl3a5vspzo7p66r.css"]'),
    undo: {},
    isPreview: false,
    caseTypes:["none", "actionsheet", "toast"],
    caseIdx: null,
    jsonUrl: "http://10.168.1.91:3000/cell.json"
  },
  /*监听data*/
  watch: {
    comps: {
       handler: function(newVal){
         //每次添加组件元素或改变属性时，把comps数据存到localstorage，key为page****
         if(this.pages.length > 1){
           window.localStorage.setItem(this.pages[this.pageIdx].id, JSON.stringify(newVal))
         }
       },
       deep: true
    },
    themes: {
       handler: function(newVal){
          Store.save('themes-list', newVal)
       },
       deep: true
    },
    pages: {
       handler: function(newVal){
          Store.save('pages', newVal)
       },
       deep: true
    },
    pageIdx: {
       handler: function(newVal){
          Store.save('pageIdx', newVal)
       },
       deep: true
    },
    generateHtml: {
       handler: function(newVal){
          Store.save('html-list', newVal)
       },
       deep: true
    },
    tabbar: {
       handler: function(newVal){
          Store.save('tabbar', newVal)
       },
       deep: true
    },
    iconfont: {
       handler: function(newVal){
          Store.save('iconfont', newVal)
       },
       deep: true
    }
  },
  mounted:function() {
    var _this = this
    this.$nextTick(function () {
      
      // 初始化：判断localstorage上有没有key，如果没有对应的key就加载初始页，如果有key，就不加加载默认页，防止page都被删除后，又加载了默认页面
      var lsPageIdx = Store.fetch("pageIdx", null)
      if( lsPageIdx == null){
        if(this.pages.length < 3){
          //初始化pages
          this.pages = [{"name":"欢迎页","id":"page1001","title":"欢迎页","isHeader":true,"isTabbar":false},{"name":"示例","id":"page1002","title":"示例","isHeader":true,"isTabbar":false},{}]

          //初始化"欢迎页"的comps数据, 延迟100ms后向comps添加数据
          setTimeout(function(){ 
             _this.comps = [{"name":"htmlComp","vhtml":"<div class='welcome'>\n  <h3>\n<p>欢迎使用</p></h3>\n\n</div>","vcss":"<style>\n.welcome h3{\n  text-align:center;\n  font-size:20px;\n}\n.welcome{\n  padding:80px 0 100px;\n  margin-bottom:15px;\n  background-color:#fff\n}\n</style>"},{"name":"btnComp","class":"primary","linkto":"示例","text":"查看示例","inputname":"","caseid":"caseid100","type":"none"},{}]
          },100)

          //初始化"示例"的localstorage的数据，在切换到此page时替换comps中的数据
          window.localStorage.setItem("page1002", JSON.stringify([{"name":"inputComp","title":"个人信息","inputname":"","cells":[{"tag":"姓名","control":"","button":""},{"tag":"手机号","control":"","button":"验证码"}],"isMerge":false,"isShow":true},{}]))

          //初始化generateHtml； to fixed:在page1002的html内容要再update钩子函数中生成，在切换page时自动update，首次加载时如果没有切换page，直接点击preview或download，不会生成“示例”页的html
          this.generateHtml = [{"getHtml":"","getCss":""},{"getHtml":"","getCss":""},{}]

        }
      }
      
      //根据pageIdx初始化comps: 从localstorage的key = page****中获取数据,
      if(this.pages[this.pageIdx].id){
        this.comps  = Store.fetch(this.pages[this.pageIdx].id, '[{}]')
      }
    })
  },
  
  methods:{

    //删除组件
    removeComp(){
      //undo:存储删除的comp信息
      this.undo = {}
      this.undo['type'] = "undoComp"
      this.undo['index'] = this.compIdx
      this.undo['compinfo'] = this.comps[this.compIdx]
      
      //删除相关联的事件
      if(this.comps[this.compIdx].caseid){
        this.caseDel(this.comps[this.compIdx].caseid)
      }
      this.comps.splice(this.compIdx,1)
      $(".select-box").hide()
    },

    //隐藏select-box
    hideSelBox(){
      $(".select-box").hide()
    },

    //选择组件
    selectComp(event, obj){
      var ele = $(event.target)
        
      if(ele.parents("[data-comp=drag-div]")[0]){ //捕获html片段的父元素,data-comp="drag-div"可以选中这个组件所有
        ele = ele.parents("[data-comp=drag-div]")
      } 
      var eleScrollTop = $(".sm-container").scrollTop()
      var marginTop = ele.css("margin-top") 
      marginTop = marginTop.substring(0, marginTop.length - 2)
      var eleTop = ele.position().top + eleScrollTop + parseInt(marginTop) //position的位置 + margin-top的值 + scrolltop，才是元素实际的top
      $(".select-box").show().css({top: eleTop, height: ele.outerHeight() + "px"})
      
      this.compIdx = this.comps.indexOf(obj)
      //选中组件的样式
      this.selectedCls = this.comps[this.compIdx].class
      
      //切换属性面板
      this.panelProp = this.comps[this.compIdx].name
      
      //选择对应的caseComp的id
      this.caseidSet(this.comps[this.compIdx].caseid)
      
    },
    //属性展开收缩
    toggleCls(event){
      var ele = $(event.target)
      ele.parents(".pro-item").toggleClass("category-toggle")
    },
    
    //监听html编辑器文本框滚动
    codeScroll(event){
      var ele = $(event.target)
      var domsctop = ele.scrollTop()
      var domscleft = ele.scrollLeft()
      $(".codeMask").scrollTop(domsctop).scrollLeft(domscleft)
    },
    
    //html编辑框全屏
    fullscreen(){
      $(".content").toggleClass("fs-cnt")
      $(".property").toggleClass("fs-prop")
      $(".fullscreen").toggleClass("fs-reset")
      this.hideSelBox()
    },
    
    /*===========================
      * page列表操作 
      * 1、addPage： 新增page时comps和localstorage转换过程： 
      *** a：先在localstorage上新增一个page****的key，赋值[{}]
      *** b：延迟100ms后trigger  li，赋值this.comps即空的[{}], 触发了watch
      *** c：this.generateHtml增加一个对应的空元素
      *
    =============================*/
    addPage(){
      //通过pages的length来判断
      var currentPage 
      if(this.pages.length > 1){
        currentPage = this.pageIdx + 1
        var ele = $(".page-list li").eq(this.pageIdx)
        setTimeout(function(){ 
          ele.next().trigger("click") 
        },100)
      }else{
        currentPage = 0
      }
      //新增一个page
      this.pages.splice(currentPage, 0, {
           name: "page" + this.pages.length,
           id: "page" + Math.round(Math.random() * 10000),
           title: "导航栏",
           isHeader: true,
           isTabbar: false
         })
      //新增localStorage上page****的空值，上面ele的trigger的时候需要到
      window.localStorage.setItem(this.pages[currentPage].id, JSON.stringify([{}]))  
      
      //新增generateHtml，需有pages对应个数
      this.generateHtml.splice(currentPage, 0, {
         getHtml: "",
         getCss: ""
       })
    },    
    selectPage(event, pageIdx){
      var ele
      if (event.target.nodeName == "LI"){
         ele = $(event.target)
      }else{
         ele = $(event.target).parents("li")
      }
      
      this.pageIdx = pageIdx
      var liId = ele.attr("id")
      
      this.compIdx = 0 //在切换page的时候compIdx要重置0，不然会找不到对应的组件属性，如.text .class .vhtml等
      this.comps = JSON.parse(window.localStorage.getItem(liId))  //注意：这里会触发comps的watch
      
      this.panelProp = "pageComp"
      $(".select-box").hide()
      
      //切换到其他page时，将caseComp弹出层隐藏
      $.each(this.comps, function(i, item){
        if(item.isToggle){
          item.isToggle = false;
        }
      })
      
    },    
    delectPageConfirm(){
      //undo:存储删除的page信息
      this.undo = {}
      this.undo['type'] = "undoPage"
      this.undo['index'] = this.pageIdx
      this.undo['pageinfo'] = this.pages[this.pageIdx]
      this.undo['pagecomps'] = Store.fetch(this.undo.pageinfo.id)
      this.undo['htmlinfo'] = this.generateHtml[this.pageIdx]
      
      //删除对应的generateHtml
      this.generateHtml.splice(this.pageIdx, 1)  
      
      //删除 page
      var ele = $(".page-list li").eq(this.pageIdx)
      this.pages.splice(this.pageIdx, 1)
      
      if(this.pageIdx == 0 && this.pages.length !=1){
        setTimeout(function(){ //如果没有延迟100ms，模拟器显示的是删除前的this.pages[0]的内容
          ele.trigger("click")
        },100)
      }else{
        ele.prev().trigger("click") //trigger对应的是LI元素，所以select中event.target也要是LI  
      }
      
      //删除 localstorage中的对应的page 内容    
      var liId = ele.attr("id") 
      window.localStorage.removeItem(liId)
      
      
      
      if(this.pages.length == 1){ //删除最后一个
        this.comps = [{}]
      }
      
      $("#modal-page").removeClass("in")
      $(".modal-mask").removeClass("in")
      
    },   
    delectPage(){
      $("#modal-page").addClass("in")
      $(".modal-mask").addClass("in")
    },
    getPageinfo(){
       var len = this.generateHtml.length - 1
       var pagecss = ""
       //将每个page的html赋值表单value
       $.each(this.generateHtml, function(i, item){
         
         if( i == len){
           return
         }else{
           if($("#phtml" + i)[0]){
             $("#phtml" + i).val(item.getHtml)
           }else{
             $("#form-cvs").append($('<input type="hidden" name="pagehtml">').attr({"value": item.getHtml,"id": "phtml" + i }))
           }
           pagecss += item.getCss
         }
       })
       //将每个page的"name"赋值表单value
       $.each(this.pages, function(i, item){
         if( i == len){
           return
         }else{
           if($("#pname" + i)[0]){
             $("#pname" + i).val(item.name)
           }else{
             $("#form-cvs").append($('<input type="hidden" name="pagename">').attr({"value": item.name,"id": "pname" + i }))
           }
        }
       })
       
       //所有的page的自定义的css合并在一起
       if($("#pcss")[0]){
         $("#pcss").val(pagecss)
       }else{
         $("#form-cvs").append($('<input type="hidden" name="pagecss">').attr({"value": pagecss, "id": "pcss"}))
       }
    },
    //export page info
    submit(){
       this.getPageinfo()
       Store.save('html-list', this.generateHtml)
       $("#form-cvs").submit()
    },
    //preview page
    preview(){
        
       $(".navbar a").toggleClass("active")
       this.isPreview = !this.isPreview
       if(this.isPreview == true){
         this.getPageinfo()
         var pagehtmlNew = []
         var pagenameNew = []
         var pagecssNew = []
         $.each($("[name=pagehtml]"), function(i, obj){
             pagehtmlNew.push(obj.value)
         })
         $.each($("[name=pagename]"), function(i, obj){
             pagenameNew.push(obj.value)
         })
         $.each($("[name=pagecss]"), function(i, obj){
             pagecssNew.push(obj.value)
         })

         $.ajax({
            type: 'post',
            url: 'http://10.168.1.91:3000/preview',
            data:{ pagehtmlNew: JSON.stringify(pagehtmlNew), pagenameNew: JSON.stringify(pagenameNew), pagecssNew: JSON.stringify(pagecssNew)},
            dataType: 'json',
            success: function(data){
              //接受服务器返回的数据
              //$("#preview-loading").html(data.some)
              $(".preview-loading").hide()
              $("#preview-frame").attr("src","http://10.168.1.91:3000/preview")
            }
         })
       }else{
           $("#form-cvs input[type=hidden]").remove()
         }
    },
    /*===========================
      iconfont select
    =============================*/
    chooseIcon(event){
      var $el = $(event.target)
      $("#modal-iconfont").addClass("in")
      $(".modal-mask").addClass("in")
     
      $.ajax({  
        type:"get",  
        url:"https:" + this.iconfont, 
        success:function(data){  
          var arr = data.match(/i(\S*)before/g); //get classname from character i to before
          var iconlist = ''
          arr.forEach(function(item){ 
           var cls = item.substring(0, item.indexOf(":"))
           iconlist +=  "<i class=" + cls  + "></i>"
          }) 
          //click icon
          $(".iconfont-show").html(iconlist).find("i").on("click", function(){
            var clsName = $(this).attr("class")
            
            $el.prev().val(clsName)
            $el.prev().trigger("click")
            
            $("#modal-iconfont").removeClass("in")
            $(".modal-mask").removeClass("in")
          })
        } 
      })
    },
    /*===========================
      undo:撤消
    =============================*/
    undoThis(){
      if(JSON.stringify(this.undo) == "{}"){
        return 
      }else{
        
        if(this.undo.type == "undoPage"){
          //undo:把删除的数据pages重新插入
          this.pages.splice(this.undo.index, 0, this.undo.pageinfo)
          this.generateHtml.splice(this.undo.index, 0, this.undo.htmlinfo)
          window.localStorage.setItem(this.undo.pageinfo.id, JSON.stringify(this.undo.pagecomps))
          /*删除的是第一个撤消时要trigger一下,新的第一个li,data更新有延迟*/
          if(this.undo.index == 0){
             setTimeout(function(){ 
              $(".page-list li").eq(0).trigger("click")
             },100)
          }
        }else if(this.undo.type == "undoComp"){
          //undo:把删除的数据pages重新插入
          this.comps.splice(this.undo.index, 0, this.undo.compinfo)
        }
        this.undo = {}
      }
    },
    /*===========================
      组件拖放排序
    =============================*/
    //拖动当前组件-在画布中拖动
    drag:function(event){
      dom = event.currentTarget
      domId = $(dom).attr("id")
      $clonedom = $(dom).clone(true)
      cloneId =  $clonedom.attr("id")
      isDragin = false
      $(".select-box").hide()
    },
    //拖动组件库-start-在组件库中开始拖
    dragItem:function(compType){
      //此函数作用主要是更新id和dom，没有实际作用
      switch(compType) {
          case "anyComp":
            dom = $('<div data-comp="drag-div" id="0" draggable="true"></div>')
            break
      }
      
      domId = $(dom).attr("id")
      $clonedom = $(dom).clone(true)
      cloneId = $clonedom.attr("id")
      isDragin = false
      $(".select-box").hide()
    },
    //拖动组件库-over-经过模拟器区域
    dragoverItem:function(){
      if(isDragin == false){
        isDragin = !isDragin
      }
    },
    dragleaveItem:function(){
      isDragin = false
    },
    //拖动组件库-end
    dragendItem:function(compType){
      var compObj
      var tgid = "tg" + Math.round(Math.random() * 10000)
      /*******表单组件*******/
      //button组件
      var btnCompObj = {
                         name: "btnComp",
                         class: "primary",
                         linkto: "#",
                         text: "按钮" + this.comps.length,
                         inputname: "",
                         caseid: "caseid" + Math.round(Math.random() * 100),
                         type: "none"
                       }
      //input组件  
      var inputCompObj = {
                         name: "inputComp",
                         title: "个人信息",
                         inputname: "",
                         tgId: tgid,
                         cells: [{tag: "姓名", control: "", button: "", id: tgid + "-1" }, {tag: "手机号", control: "", button: "", id: tgid + "-2"}],
                         isMerge: false,
                         isShow: true
                       }
      //list组件
      var listCompObj = {
                         name: "listComp",
                         title: "会员信息",
                         inputname: "",
                         tgId: tgid,
                         cells: [{tag: "会员特权", tip: "", icon: "icon-select", linkto: "#", id: tgid + "-1"},{tag: "会员认证", tip: "已认证", icon: "icon-integral", linkto: "#", id: tgid + "-2"}],
                         isMerge: false,
                         isShow: true
                       }
      //checkbox组件  
      var checkboxCompObj = {
                         name: "checkboxComp",
                         title: "您去过的城市？",
                         inputname: "city",
                         tgId: tgid,
                         cells: [{item: "福州", id: tgid + "-1"},{item: "厦门", id: tgid + "-2"},{item: "上海", id: tgid + "-3"}],
                         isMerge: false,
                         isShow: true,
                         rows: [{reverse: false, txt: "文字在左"}, {reverse: true, txt: "文字在右"}],
                         isReverse: false
        
                       }
      //radio组件
      var radioCompObj = {
                         name: "radioComp",
                         title: "您的性别？",
                         inputname: "sex",
                         tgId: tgid,
                         cells: [{item: "男", id: tgid + "-1"},{item: "女", id: tgid + "-2"}],
                         isMerge: false,
                         isShow: true,
        
                       }
      //textarea组件 
      var textareaCompObj = {
                         name: "textareaComp",
                         title: "标题",
                         inputname: "",
                         cells: [{control: ""}],
                         isMerge: false,
                         isShow: true,
        
                       }
      //switch组件 
      var switchCompObj = {
                         name: "switchComp",
                         title: "同步",
                         inputname: "synch",
                         tgId: tgid,
                         cells: [{item: "开启自动同步", id: tgid + "-1"}],
                         isMerge: false,
                         isShow: true,
        
                       }
      //select组件 
      var selectCompObj = {
                         name: "selectComp",
                         title: "标题",
                         inputname: "lang",
                         tgId: tgid,
                         cells: [{tag: "语言", selected:"请选择...", options:"中文-英文", id: tgid + "-1"}],
                         isMerge: false,
                         isShow: true
                       }
      
      /*******基础组件*******/
      //html组件
      var htmlCompObj = {
           name: "htmlComp",
           vhtml: `<div class='box'>
请在右边编辑框中插入html,实时预览效果 →
</div>`,
           vcss: `<style>
.box{
  font-size: 12px;
  padding: 10px;
  margin: 10px 0;
  background-color: #fff;
  border: 1px dashed #0cf;
}
</style>`
         }
      
      //space组件
      var spaceCompObj = {
                         name: "spaceComp",
                         sizes: ["default","sm","md","lg"],
                         size: "default"
                       }
      //panel组件 
      var panelCompObj = {
                         name: "panelComp",
                         isFigure: true,
                         tgId: tgid,
                         cells: [{title: "标题", content: "内容内容内容", linkto: "#", id: tgid + "-1"}],
                       }
      //article 组件
      var articleCompObj = {
                         name: "articleComp",
                         title: "文章的标题",
                         content: "这里显示多行内容内容内容内容内容内容内容内容内容内容内容内容内容内容内容内容内容内容",
                         isBg: true,
                       }
      //grid 组件 zz
      var gridCompObj = {
                         name: "gridComp",
                         columns: "four",
                         colors: ["#1D71E5","#F29402","#FF7070","#5D52E8","#0EA39C","#EE7116","#65BB12"],
                         tgId: tgid,
                         cells: [
                           {text: "账户", icon: "icon-addressbook", linkto: "#", colorSelected: "#1D71E5", id: tgid + "-1"},
                           {text: "转账", icon: "icon-coupons", linkto: "#", colorSelected: "#F29402", id: tgid + "-2"},
                           {text: "信用卡", icon: "icon-coupons", linkto: "#", colorSelected: "#FF7070", id: tgid + "-3"},
                           {text: "缴费", icon: "icon-createtask", linkto: "#", colorSelected: "#5D52E8", id: tgid + "-4"}]
                       }
      
      //buttonbar组件
      var buttonbarCompObj = {
                         name: "buttonbarComp",
                         tgId: tgid,
                         cells: [{text: "确定", class: "primary", linkto:"#", id: tgid + "-1"},{text: "取消", class: "primary", linkto:"#", id: tgid + "-2"}]
                       }
      
      //组件类型判断
      switch(compType) {
          case "btnComp":
            compObj = btnCompObj
            break
          case "inputComp":
            compObj = inputCompObj
            break
          case "listComp":
            compObj = listCompObj
            break
          case "checkboxComp":
            compObj = checkboxCompObj
            break
          case "radioComp":
            compObj = radioCompObj
            break
          case "textareaComp":
            compObj = textareaCompObj
            break
          case "switchComp":
            compObj = switchCompObj
            break
          case "selectComp":
            compObj = selectCompObj
            break
          case "htmlComp":
            compObj = htmlCompObj
            break
          case "spaceComp":
            compObj = spaceCompObj
            break
          case "panelComp":
            compObj = panelCompObj
            break
          case "articleComp":
            compObj = articleCompObj
            break
          case "gridComp":
            compObj = gridCompObj
            break
          case "buttonbarComp":
            compObj = buttonbarCompObj
            break
      }
      
      if(isDragin == true){
        if($clonedom.css("opacity") != "0.5"){
            this.comps.splice((this.comps.length-1), 0, compObj)
        }else{
            $clonedom.remove()
            this.comps.splice(cloneIndex, 0, compObj)
          }  
      }else{
        $clonedom.remove()
      }
      
    },
    handleDragover:function(event){ 
      //拖动经过时，添加拖动对象
      var ele = $(event.target).closest('[data-comp="drag-div"]')
      overId = ele.attr("id")
      $(dom).hide()
      if(cloneId < overId){
        ele.after($clonedom[0])
        cloneId++
      }else{
        ele.before($clonedom[0])
        cloneId--
      }
      //拖动经过时，设置拖动对象的样式
      $clonedom.css({"border":"1px dashed #5bc0de","opacity":"0.5"})
      cloneIndex =  $clonedom.index('[data-comp="drag-div"]:visible')

    },
    handleDragend:function(event){ 
      $clonedom.remove()
      $(dom).show()
      this.comps.splice(cloneIndex, 0, this.comps.splice(domId, 1)[0])
    },
    
    /*===========================
      case 操作事件
    =============================*/
    //下拉选择
    caseSelect:function(event){
      var casetype = event.target.value
      var currCaseid = this.comps[this.compIdx].caseid
      let _this = this
      var tempCaseid
      
      //当buttonComp没有关联caseComp并删除时，对应buttonComp的type为undefined
      //buttonComp删除时type没有了，关联v-modal会触发caseSelect事件
      if(_this.comps[_this.compIdx].type == undefined){
        return
      }
      if(casetype != "none" ){ 
        var caseObj
        
        
        //actionsheet脚本
        var actionsheetScript = `
                              <script>
$(":not(div)[data-case=${currCaseid}]").on("click",function(e){
  $(".sm-mask[data-case=${currCaseid}]").fadeIn(200)
  $(".sm-actionSheet[data-case=${currCaseid}]").addClass('toggle')	
})
$(".sm-mask, .action-cancel").on("click",function(e){
  e.stopPropagation()
  $(".sm-mask").fadeOut(300)
  $(".sm-actionSheet").removeClass('toggle')			
})
<\/script>
`       
        //toast脚本
        var toastScript = `
                          <script>
$(":not(div)[data-case=${currCaseid}]").on("click",function(){		
   var  $toast = $(".sm-toast[data-case=${currCaseid}]")
   if ($toast.css('display') != 'none') return;		
   $toast.fadeIn(100)
   setTimeout(function(){
     $toast.fadeOut(100)
   },2000)
})
<\/script>
`
        //根据选择的case类型，添加对应的脚本; to do: 在这里为每个事件类型添加不同的数据，变量为{...}，用splice添加
        switch(casetype) {
          case "actionsheet":
            caseObj = {name: casetype + "Comp", caseId: currCaseid, title: "标题", menu: "示例菜单一", script: actionsheetScript, isToggle: true}
            break
          case "toast":
            caseObj = {name: casetype + "Comp", caseId: currCaseid, tips: "加载中", icon: "sm-icon-loading", script: toastScript, isToggle: true}
            break
        }
        
        //第一次添加case组件
        if(_this.caseIdx == null){
           _this.comps.splice((_this.comps.length-1), 0, caseObj) 
           _this.caseIdx = _this.comps.length-2
        }else{
          
          $.each(_this.comps, function(i, item){
            if(item.caseId == currCaseid){
               if(_this.compIdx != i){
                 _this.caseIdx = i
                 tempCaseid = _this.comps[i].caseId
                 _this.comps.splice(i, 1)
                 _this.comps.splice(i, 0, caseObj) 
               }
            }
          })
          
          //添加第二个case组件时，判断选中的buttonComp没有对应case组件，则新增一个case组件
          if(tempCaseid != currCaseid){
            _this.comps.splice((_this.comps.length-1), 0, caseObj) 
            _this.caseIdx = _this.comps.length-2
          }
        }
        
      }else{
        this.caseDel(currCaseid)
      }
    },
    //删除事件函数-判断选中id与关联事件组件id是否一致
    caseDel:function(caseid){
      let _this = this
      $.each(_this.comps, function(i, item){
           if(item.caseId == caseid){
             if(_this.compIdx != i){
               _this.comps.splice(i, 1)
               return false
             }
           }
      })
    },
    //选择buttonComp时就关联了对应的caseComp的id
    caseidSet:function(caseid){
      let _this = this
      $.each(_this.comps, function(i, item){
           if(item.caseId == caseid){
             if(_this.compIdx != i){
               _this.caseIdx = i
               return false
             }
           }
      })
    },
    /*===========================
      新增组件cell
    =============================*/
    //input组件 
    addCell:function(cell){
      let _this = this
      var inputLength = _this.comps[_this.compIdx].cells.length
      _this.comps[_this.compIdx].cells.splice(inputLength, 0, cell)
    },
    //删除组件cell
    delCell:function(idx){
      let _this = this
      _this.comps[_this.compIdx].cells.splice(idx, 1)
    },
    /*===========================
      下拉框获取json数据 
    =============================*/
    getJson:function(){
      let _this = this
      $.ajax({
          type: 'get',
          url: _this.jsonUrl,
          dataType: 'json',
          success: function(data){
            //_this.comps[_this.compIdx].cells = []
            //变量json返回的cell数组,要写JSON Schema
            /*to do: 
             * 1、获取json的属性都不相同，可能是字符串，或对象，或数组；所以不能用变量，
             * 2、要更新的data中的值也不一样不一定是cells，getJson()方法需要用参数传值
             * 3、json中的字段和组件中的字段不一样，比如tag表示名称，json文件对应的不一定是tag标签
             */
//            $.each(data.cells, function(i, cell){
//              _this.comps[_this.compIdx].cells.push(cell)
//            })
          }
       })
    },
    
    /*===========================
      按钮组button bar排序 
    =============================*/
    sortBtn:function(direction,index){
      let _this = this
      var cells = _this.comps[_this.compIdx].cells
      var inputLength = _this.comps[_this.compIdx].cells.length
      if(direction == "up"){
        if(index == 0){
          return
        }
        cells[index] = cells.splice((index - 1), 1, cells[index])[0];
       
      }else{
        if(index == inputLength - 1){
          return
        }
        cells[index] = cells.splice((index + 1), 1, cells[index])[0];
      }
    }
  },
  updated:function() {
    /*
     * 在每个page生成的html中过滤html编辑生成冗余代码
     */
    var pageOfHtml = $("#canvas").clone()
    var pageOfCss = ""
   
    //获取css
    if(pageOfHtml.find("style")){
      pageOfHtml.find("style").each(function(){
        pageOfCss += $(this).html()
      })
      this.generateHtml[this.pageIdx].getCss = pageOfCss
    }
    
    //获取html
    if(pageOfHtml.find(".html-box")){
      pageOfHtml.find(".html-box").each(function(){
        var boxWp = $(this).find(".box-wp")
        $(this).replaceWith(boxWp.children())
      })
    }
    //删除select box
    pageOfHtml.find(".select-box").remove()
    
    this.generateHtml[this.pageIdx].getHtml = pageOfHtml.html()
  },
  created:function(){
    
    //撤消快捷键ctrl+z
    let _this = this;
    document.onkeydown = function(){
      if(event.ctrlKey == true && event.keyCode == 90){
        if($(".c-ipt").is(":focus") || $("textarea").is(":focus")){
          return
        }else{
          event.preventDefault()
          _this.undoThis()
        }
      }
    }    
  }
})

  
</script>